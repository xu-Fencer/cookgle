<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ recipe.name }} - 菜谱详情</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/all.css') }}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="{{ url_for('static', filename='js/index.js') }}"></script>
</head>
<body>
    <div class="container">
        <!-- 顶部栏 -->
        <div class="top-bar">
            <a href="{{ url_for('index') }}" class="logo">
                <div class="logo-icon">谷</div>
                <div class="logo-text">谷鸽</div>
            </a>
            <div class="page-title">{{ recipe.name }}</div>
            <div class="top-actions">
                <a href="{{ url_for('camera') }}" class="top-action-btn">
                    <i class="fas fa-camera"></i>
                </a>
                <a href="{{ url_for('notification') }}" class="top-action-btn">
                    <i class="fas fa-bell"></i>
                </a>
            </div>
        </div>

        <!-- 菜谱卡片 -->
        <div class="feature-card" style="margin-top:20px;">
            <div class="section-title">
                <h2>{{ recipe.name }}</h2>
                <span class="action-link">{{ recipe.category }}</span>
            </div>
            <div class="recipe-meta" style="margin-bottom: 15px;">
                <div class="meta-item">
                    <i class="fas fa-signal"></i>
                    难度：
                    {% for i in range(recipe.difficulty) %}
                        <i class="fas fa-star" style="color:var(--primary);"></i>
                    {% endfor %}
                    {% for i in range(5 - recipe.difficulty) %}
                        <i class="far fa-star" style="color:var(--text-light);"></i>
                    {% endfor %}
                </div>
                <div class="meta-item">
                    <i class="fas fa-user-friends"></i>
                    {{ recipe.servings }}人食
                </div>
            </div>
            <!-- 点赞和收藏按钮 -->
            <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                <button id="like-btn" class="action-btn {% if recipe.liked %}primary{% endif %}" style="display: flex; align-items: center; gap: 6px;">
                    <i class="fa{{ 's' if recipe.liked else 'r' }} fa-thumbs-up"></i>
                    <span id="like-count">{{ recipe.like_count }}</span>
                    <span>点赞</span>
                </button>
                <button id="collect-btn" class="action-btn {% if recipe.collected %}primary{% endif %}" style="display: flex; align-items: center; gap: 6px;">
                    <i class="fa{{ 's' if recipe.collected else 'r' }} fa-bookmark"></i>
                    <span id="collect-count">{{ recipe.collect_count }}</span>
                    <span>收藏</span>
                </button>
            </div>
            <div class="recipe-info">
                <div class="section-title" style="border-left:0;">
                    <h2>菜谱简介</h2>
                </div>
                <div class="info-content" style="margin-bottom:20px;">
                    {{ recipe.description_html|safe }}
                </div>

                <div class="section-title" style="border-left:0;">
                    <h2>所需食材</h2>
                </div>
                <div class="info-content" style="margin-bottom:20px;">
                    {{ recipe.ingredients_html|safe }}
                </div>

                <div class="section-title" style="border-left:0;">
                    <h2>制作步骤</h2>
                </div>
                <div class="info-content" style="margin-bottom:20px;">
                    {% if recipe.steps_html %}
                        {{ recipe.steps_html|safe }}
                    {% else %}
                        <span style="color:var(--text-light);">暂无步骤说明</span>
                    {% endif %}
                </div>

                <div class="section-title" style="border-left:0;">
                    <h2>注意事项</h2>
                </div>
                <div class="info-content">
                    {{ recipe.additional_notes_html|safe }}
                </div>
            </div>
        </div>
    </div>

    <!-- 底部导航栏 -->
    <div class="bottom-nav">
        <a href="{{ url_for('index') }}" class="nav-item">
            <i class="nav-icon fas fa-home"></i>
            <span>首页</span>
        </a>
        <a href="{{ url_for('discover') }}" class="nav-item">
            <i class="nav-icon fas fa-search"></i>
            <span>发现</span>
        </a>
        <a href="{{ url_for('share') }}" class="nav-item">
            <i class="nav-icon fas fa-plus-circle"></i>
            <span>分享</span>
        </a>
        <a href="{{ url_for('square') }}" class="nav-item">
            <i class="nav-icon fas fa-heart"></i>
            <span>广场</span>
        </a>
        <a href="{{ url_for('profile') }}" class="nav-item">
            <i class="nav-icon fas fa-user"></i>
            <span>我的</span>
        </a>
    </div>
    <script>
        // 点赞
        $('#like-btn').click(function() {
            var liked = $(this).hasClass('primary');
            var count = parseInt($('#like-count').text());
            if (liked) {
                $(this).removeClass('primary');
                $(this).find('i').removeClass('fas').addClass('far');
                $('#like-count').text(count - 1);
            } else {
                $(this).addClass('primary');
                $(this).find('i').removeClass('far').addClass('fas');
                $('#like-count').text(count + 1);
            }
        });
        // 收藏
        $('#collect-btn').click(function() {
            var collected = $(this).hasClass('primary');
            var count = parseInt($('#collect-count').text());
            if (collected) {
                $(this).removeClass('primary');
                $(this).find('i').removeClass('fas').addClass('far');
                $('#collect-count').text(count - 1);
            } else {
                $(this).addClass('primary');
                $(this).find('i').removeClass('far').addClass('fas');
                $('#collect-count').text(count + 1);
            }
        });
    </script>
</body>
</html>
